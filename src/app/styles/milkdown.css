.milkdown {
  .ProseMirror.editor {
    outline: none;
  }

  /* .prosemirror-virtual-cursor + *, */
  & .ProseMirror.editor *:first-child {
    margin-top: 0;
  }
}

.milkdown .selected img {
  @apply opacity-80;
}

.milkdown-tooltip {
  svg {
    fill: var(--color-base-content);
    width: 14px;
    height: 14px;
  }
}

.milkdown .drag-handle {
  @apply absolute btn btn-xs btn-square btn-soft;
  @apply hidden md:flex;
  transition: all 0.15s ease-in-out;

  &[data-show="false"]:not(:focus-within) {
    opacity: 0;
  }

  & svg {
    fill: var(--color-base-content);
    width: 9px;
  }
}

.prosemirror-virtual-cursor {
  @apply absolute;
}

.milkdown .slash-menu {
  @apply absolute;

  &[data-show="false"] {
    display: none;
  }
}

.milkdown .placeholder::before {
  pointer-events: none;
  white-space: pre;
  content: attr(data-placeholder);
  opacity: 0.6;
}

.milkdown .milkdown-table-block {
  .milkdown-icon svg {
    fill: var(--color-base-content);
    width: 14px;
    height: 14px;
  }

  & .drag-preview {
    @apply absolute opacity-60;
  }

  & .handle.cell-handle {
    @apply btn btn-xs btn-soft z-50;

    &[data-role="col-drag-handle"] {
      @apply px-1 h-4 w-8;
      transform: translateY(50%);
    }

    &[data-role="row-drag-handle"] {
      @apply py-1 w-4;
      transform: translate(50%);
    }
  }

  & .drag-preview[data-show="false"] {
    display: none;
  }

  .handle {
    position: absolute;
  }

  & [data-show="false"]:not(:focus-within) {
    opacity: 0;
  }

  & .button-group[data-show="false"] {
    display: none;
  }

  & .button-group {
    @apply absolute flex gap-2 bg-base-200 p-2 rounded-sm;
    transform: translate(-50%);
    left: 50%;
    top: -45px;

    & button {
      @apply btn btn-soft btn-square btn-xs;
    }
  }

  & .selectedCell {
    @apply bg-base-200;
  }

  & .line-handle {
    @apply bg-primary;
  }

  & .line-handle .add-button {
    transform: translate(-50%, -50%);
    @apply absolute btn btn-xs btn-square btn-soft z-30;
  }

  & .line-handle[data-role="y-line-drag-handle"] {
    width: 1px;
  }

  & .line-handle[data-role="x-line-drag-handle"] {
    height: 1px;
  }
}

.milkdown .milkdown-image-block {
  position: relative;
  margin: 2rem 0 2rem 0;
  img {
    @apply min-h-[100px] min-w-[100px];
    margin-top: 0 !important;
    margin-bottom: 0 !important;
  }

  .image-wrapper {
    @apply w-fit relative mx-auto my-0 bg-primary-content/10 rounded;
  }

  .operation {
    position: absolute;
    right: 0.25rem;
    z-index: 1;

    .operation-item {
      @apply btn btn-square btn-soft btn-xs;
      svg {
        fill: currentColor;
        width: 14px;
        height: 14px;
      }
    }
  }

  .image-resize-handle {
    @apply w-3/4 max-w-48 absolute left-1/2 -translate-y-0.5 -translate-x-1/2 h-[4px] bg-base-content rounded opacity-0 hover:opacity-0 transition-opacity;
    cursor: row-resize;
  }
  &:hover .image-resize-handle {
    @apply opacity-50;
  }

  .caption-input {
    outline: none;
    text-align: center;
    width: 100%;
  }
}

.milkdown .image-edit {
  @apply flex items-center p-4 bg-base-200 rounded gap-2;

  svg {
    fill: var(--color-base-content);
  }

  .link-importer {
    @apply relative flex-1;

    .uploader {
      @apply font-bold cursor-pointer hover:underline transition-colors;
    }

    &.focus .uploader {
      @apply text-base-content/50 pointer-events-none;
    }

    .link-input-area {
      @apply w-full px-2;
    }

    span.text {
      @apply ml-1 text-base-content/50;
    }

    .placeholder {
      @apply absolute top-0 bottom-0 left-0 cursor-text;
    }
  }

  .confirm {
    @apply btn btn-primary btn-sm;
  }
}

.prose .milkdown table {
  & td:first-child,
  & th:first-child {
    padding-left: 1.25em;
  }

  th {
    padding-top: 0.75em;
  }
}
